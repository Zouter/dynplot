---
title: "dynplot: Common visualisation tools for single-cell trajectories"
output:
  github_document:
    html_preview: false
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup1, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%",
  fig.path = "man/figures/",
  message = FALSE,
  dpi = 300
)
```

<a href="https://github.com/dynverse/dynplot/actions?query=workflow%3AR-CMD-check"><img src="https://github.com/dynverse/dynplot/workflows/R-CMD-check/badge.svg" align="left"></a> 
<a href="https://codecov.io/gh/dynverse/dynplot"><img src="https://codecov.io/gh/dynverse/dynplot/branch/master/graph/badge.svg" align="left" /></a>  
[**ℹ️ Tutorials**](https://dynverse.org)  &nbsp;  &nbsp; 
[**ℹ️ Reference documentation**](https://dynverse.org/reference/dynplot) <br><img src="man/figures/logo.png" align="right" />


The package provides different ways of plotting the topology and/or cellular properties of a trajectory.

Here's a summary of the provided plotting functions.


```{r, echo=FALSE, warning=FALSE}
library(tidyverse)
library(dyno)

library(patchwork)

data(example_bifurcating)
trajectory <- example_bifurcating

trajectory <- trajectory %>% add_root()
grouping <- trajectory$prior_information$groups_id
groups <- tibble(dynwrap::group_onto_nearest_milestones(trajectory)) %>% 
  mutate(color=dynplot:::milestone_palette_list$auto(n()))
features_oi <- apply(as.matrix(trajectory$counts), 2, sd) %>% sort() %>% names() %>% tail(10)
feature_oi <- features_oi[[10]]
```


```{r cells, fig.width=18, fig.height=12, echo=FALSE, warning=FALSE}
empty <- ggplot() + theme_void()
question <- empty + geom_text(aes(0, 0, label="????"))
unavailable <- empty + geom_text(aes(0, 0, label="----"))

title <- list(
  dynplot:::empty_plot(),
  empty + geom_label(aes(0, 0, label="Topology")),
  empty + geom_label(aes(0, 0, label="Ordering")),
  empty + geom_label(aes(0, 0, label="Grouping/clustering")),
  empty + geom_label(aes(0, 0, label="Expression of \n a single gene")), 
  empty + geom_label(aes(0, 0, label="Pseudotime"))
)

dendro <- list(
  empty + geom_label(aes(0, 0, label="plot_dendro()")),
  plot_dendro(trajectory),
  plot_dendro(trajectory, "milestone"),
  plot_dendro(trajectory, grouping=grouping, groups=groups),
  plot_dendro(trajectory, feature_oi=feature_oi),
  plot_dendro(trajectory, "pseudotime")
)

onedim <- list(
    empty + geom_label(aes(0, 0, label="plot_onedim()")),
    plot_onedim(trajectory),
    plot_onedim(trajectory, "milestone"),
    plot_onedim(trajectory, grouping=grouping, groups=groups),
    plot_onedim(trajectory, feature_oi=feature_oi),
    plot_onedim(trajectory, "pseudotime")
  )

graph <- list(
  empty + geom_label(aes(0, 0, label="plot_graph()")),
  plot_graph(trajectory),
  plot_graph(trajectory, "milestone"),
  plot_graph(trajectory, grouping=grouping, groups=groups),
  plot_graph(trajectory, feature_oi=feature_oi),
  plot_graph(trajectory, "pseudotime")
)

dimred <- list(
  empty + geom_label(aes(0, 0, label="plot_dimred()")),
  plot_dimred(trajectory),
  plot_dimred(trajectory, "milestone"),
  plot_dimred(trajectory, grouping=grouping, groups=groups),
  plot_dimred(trajectory, feature_oi=feature_oi),
  plot_dimred(trajectory, "pseudotime")
)

wrap_plots(
  c(title, dendro, onedim, graph, dimred),
  # heights = c(1, 3, 3, 3, 3, 3),
  # ncol = 5,
  # byrow = FALSE
  widths = c(1, 3, 3, 3, 3, 3),
  nrow = 5,
  byrow = TRUE
) & theme(legend.position = "none")
```

In addition, you can also plot the expression of genes along the trajectory as a heatmap.

```{r heatmap, echo=FALSE, fig.width=10, fig.height=6}
plot_heatmap(trajectory, grouping = trajectory$prior_information$grouping_assignment)
```

Or create a comparison plot between two trajectories for the same cells.
```{r scatterplot, echo=FALSE, fig.width=6, fig.height=6}
plot_linearised_comparison(trajectory, trajectory)
```


## Latest changes

Check out `news(package = "dynwrap")` or [NEWS.md](NEWS.md) for a full list of changes.

<!-- This section gets automatically generated from inst/NEWS.md -->

```{r news, echo=FALSE, results="asis"}
cat(dynutils::recent_news())
```

